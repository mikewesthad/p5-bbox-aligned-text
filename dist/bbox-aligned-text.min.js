!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.BboxAlignedText=t()}}(function(){return function t(i,e,s){function o(h,r){if(!e[h]){if(!i[h]){var a="function"==typeof require&&require;if(!r&&a)return a(h,!0);if(n)return n(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var c=e[h]={exports:{}};i[h][0].call(c.exports,function(t){var e=i[h][1][t];return o(e?e:t)},c,c.exports,t,i,e,s)}return e[h].exports}for(var n="function"==typeof require&&require,h=0;h<s.length;h++)o(s[h]);return o}({1:[function(t,i,e){function s(t,i,e,o){this._font=t,this._text=i,this._fontSize=void 0!==e?e:12,this.p=o||window,this._rotation=0,this._hAlign=s.ALIGN.CENTER,this._vAlign=s.BASELINE.CENTER,this._calculateMetrics(!0)}i.exports=s,s.ALIGN={LEFT:"left",CENTER:"center",RIGHT:"right"},s.BASELINE={BOX_TOP:"top",BOX_CENTER:"center",BOM_BOTTOM:"bottom",FONT_CENTER:"font_center",ALPHABETIC:"alphabetic"},s.prototype.setText=function(t){this._text=t,this._calculateMetrics(!1)},s.prototype.setTextSize=function(t){this._fontSize=t,this._calculateMetrics(!0)},s.prototype.setRotation=function(t){this._rotation=t},s.prototype.setAnchor=function(t,i){this._hAlign=t||s.ALIGN.CENTER,this._vAlign=i||s.BASELINE.CENTER},s.prototype.getBbox=function(t,i){var e=this._calculateAlignedCoords(t,i);return{x:e.x+this._boundsOffset.x,y:e.y+this._boundsOffset.y,w:this.width,h:this.height}},s.prototype.draw=function(t,i,e){e=e||!1;var s={x:void 0!==t?t:0,y:void 0!==i?i:0};if(this.p.push(),this._rotation&&(s=this._calculateRotatedCoords(s.x,s.y,this._rotation),this.p.rotate(this._rotation)),s=this._calculateAlignedCoords(s.x,s.y),this.p.textAlign(this.p.LEFT,this.p.BASELINE),this.p.textFont(this._font),this.p.textSize(this._fontSize),this.p.text(this._text,s.x,s.y),e){this.p.stroke(200);var o=s.x+this._boundsOffset.x,n=s.y+this._boundsOffset.y;this.p.noFill(),this.p.rect(o,n,this.width,this.height)}this.p.pop()},s.prototype._calculateRotatedCoords=function(t,i,e){var s=Math.cos(e)*t+Math.cos(Math.PI/2-e)*i,o=-Math.sin(e)*t+Math.sin(Math.PI/2-e)*i;return{x:s,y:o}},s.prototype._calculateAlignedCoords=function(t,i){var e,o;switch(this._hAlign){case s.ALIGN.LEFT:e=t;break;case s.ALIGN.CENTER:e=t-this.halfWidth;break;case s.ALIGN.RIGHT:e=t-this.width;break;default:e=t,console.log("Unrecognized horizonal align:",this._hAlign)}switch(this._vAlign){case s.BASELINE.TOP:o=i-this._boundsOffset.y;break;case s.BASELINE.CENTER:o=i+this._distBaseToMid;break;case s.BASELINE.BOTTOM:o=i-this._distBaseToBottom;break;case s.BASELINE.FONT_CENTER:o=i-this._descent+(this._ascent+this._descent)/2;break;case s.BASELINE.ALPHABETIC:o=i;break;default:o=i,console.log("Unrecognized vertical align:",this._vAlign)}return{x:e,y:o}},s.prototype._calculateMetrics=function(t){var i=this._font.textBounds(this._text,1e3,1e3,this._fontSize);i.x-=1e3,i.y-=1e3,t&&(this._ascent=this._font._textAscent(this._fontSize),this._descent=this._font._textDescent(this._fontSize)),this.width=i.w,this.height=i.h,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this._boundsOffset={x:i.x,y:i.y},this._distBaseToMid=Math.abs(i.y)-this.halfHeight,this._distBaseToBottom=this.height-Math.abs(i.y)}},{}]},{},[1])(1)});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvYmJveC1hbGlnbmVkLXRleHQuanMiLCJiYm94LWFsaWduZWQtdGV4dC5qcyJdLCJuYW1lcyI6WyJmIiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImciLCJ3aW5kb3ciLCJnbG9iYWwiLCJzZWxmIiwidGhpcyIsIkJib3hBbGlnbmVkVGV4dCIsImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJFcnJvciIsImNvZGUiLCJsIiwiY2FsbCIsImxlbmd0aCIsIjEiLCJmb250IiwidGV4dCIsImZvbnRTaXplIiwicEluc3RhbmNlIiwiX2ZvbnQiLCJfdGV4dCIsIl9mb250U2l6ZSIsInVuZGVmaW5lZCIsInAiLCJfcm90YXRpb24iLCJfaEFsaWduIiwiQUxJR04iLCJDRU5URVIiLCJfdkFsaWduIiwiQkFTRUxJTkUiLCJfY2FsY3VsYXRlTWV0cmljcyIsIkxFRlQiLCJSSUdIVCIsIkJPWF9UT1AiLCJCT1hfQ0VOVEVSIiwiQk9NX0JPVFRPTSIsIkZPTlRfQ0VOVEVSIiwiQUxQSEFCRVRJQyIsInByb3RvdHlwZSIsInNldFRleHQiLCJzdHJpbmciLCJzZXRUZXh0U2l6ZSIsInNldFJvdGF0aW9uIiwiYW5nbGUiLCJzZXRBbmNob3IiLCJoQWxpZ24iLCJ2QWxpZ24iLCJnZXRCYm94IiwieCIsInkiLCJwb3MiLCJfY2FsY3VsYXRlQWxpZ25lZENvb3JkcyIsIl9ib3VuZHNPZmZzZXQiLCJ3Iiwid2lkdGgiLCJoIiwiaGVpZ2h0IiwiZHJhdyIsImRyYXdCb3VuZHMiLCJwdXNoIiwiX2NhbGN1bGF0ZVJvdGF0ZWRDb29yZHMiLCJyb3RhdGUiLCJ0ZXh0QWxpZ24iLCJ0ZXh0Rm9udCIsInRleHRTaXplIiwic3Ryb2tlIiwiYm91bmRzWCIsImJvdW5kc1kiLCJub0ZpbGwiLCJyZWN0IiwicG9wIiwicngiLCJNYXRoIiwiY29zIiwiUEkiLCJyeSIsInNpbiIsIm5ld1giLCJuZXdZIiwiaGFsZldpZHRoIiwiY29uc29sZSIsImxvZyIsIlRPUCIsIl9kaXN0QmFzZVRvTWlkIiwiQk9UVE9NIiwiX2Rpc3RCYXNlVG9Cb3R0b20iLCJfZGVzY2VudCIsIl9hc2NlbnQiLCJzaG91bGRVcGRhdGVIZWlnaHQiLCJib3VuZHMiLCJ0ZXh0Qm91bmRzIiwiX3RleHRBc2NlbnQiLCJfdGV4dERlc2NlbnQiLCJoYWxmSGVpZ2h0IiwiYWJzIl0sIm1hcHBpbmdzIjoiQ0FBQSxTQUFBQSxHQUFBLEdBQUEsZ0JBQUFDLFVBQUEsbUJBQUFDLFFBQUFBLE9BQUFELFFBQUFELFFBQUEsSUFBQSxrQkFBQUcsU0FBQUEsT0FBQUMsSUFBQUQsVUFBQUgsT0FBQSxDQUFBLEdBQUFLLEVBQUFBLEdBQUEsbUJBQUFDLFFBQUFBLE9BQUEsbUJBQUFDLFFBQUFBLE9BQUEsbUJBQUFDLE1BQUFBLEtBQUFDLEtBQUFKLEVBQUFLLGdCQUFBVixNQUFBLFdBQUEsTUFBQSxTQUFBVyxHQUFBQyxFQUFBQyxFQUFBQyxHQUFBLFFBQUFDLEdBQUFDLEVBQUFDLEdBQUEsSUFBQUosRUFBQUcsR0FBQSxDQUFBLElBQUFKLEVBQUFJLEdBQUEsQ0FBQSxHQUFBRSxHQUFBLGtCQUFBQyxVQUFBQSxPQUFBLEtBQUFGLEdBQUFDLEVBQUEsTUFBQUEsR0FBQUYsR0FBQSxFQUFBLElBQUFJLEVBQUEsTUFBQUEsR0FBQUosR0FBQSxFQUFBLElBQUFoQixHQUFBLEdBQUFxQixPQUFBLHVCQUFBTCxFQUFBLElBQUEsTUFBQWhCLEdBQUFzQixLQUFBLG1CQUFBdEIsRUFBQSxHQUFBdUIsR0FBQVYsRUFBQUcsSUFBQWYsV0FBQVcsR0FBQUksR0FBQSxHQUFBUSxLQUFBRCxFQUFBdEIsUUFBQSxTQUFBVSxHQUFBLEdBQUFFLEdBQUFELEVBQUFJLEdBQUEsR0FBQUwsRUFBQSxPQUFBSSxHQUFBRixFQUFBQSxFQUFBRixJQUFBWSxFQUFBQSxFQUFBdEIsUUFBQVUsRUFB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QSxPQUFBb0IsRUFBQTZCLEVBQUE1QixFQUFBNkIsSUFRQWhGLEVBQUF3QyxVQUFBUixrQkFBQSxTQUFBMEQsR0FHQSxHQUFBQyxHQUFBNUYsS0FBQXNCLE1BQUF1RSxXQUFBN0YsS0FBQXVCLE1BQUEsSUFBQSxJQUFBdkIsS0FBQXdCLFVBQ0FvRSxHQUFBekMsR0FBQSxJQUNBeUMsRUFBQXhDLEdBQUEsSUFFQXVDLElBQ0EzRixLQUFBMEYsUUFBQTFGLEtBQUFzQixNQUFBd0UsWUFBQTlGLEtBQUF3QixXQUNBeEIsS0FBQXlGLFNBQUF6RixLQUFBc0IsTUFBQXlFLGFBQUEvRixLQUFBd0IsWUFJQXhCLEtBQUF5RCxNQUFBbUMsRUFBQXBDLEVBQ0F4RCxLQUFBMkQsT0FBQWlDLEVBQUFsQyxFQUNBMUQsS0FBQWtGLFVBQUFsRixLQUFBeUQsTUFBQSxFQUNBekQsS0FBQWdHLFdBQUFoRyxLQUFBMkQsT0FBQSxFQUNBM0QsS0FBQXVELGVBQUFKLEVBQUF5QyxFQUFBekMsRUFBQUMsRUFBQXdDLEVBQUF4QyxHQUNBcEQsS0FBQXNGLGVBQUFYLEtBQUFzQixJQUFBTCxFQUFBeEMsR0FBQXBELEtBQUFnRyxXQUNBaEcsS0FBQXdGLGtCQUFBeEYsS0FBQTJELE9BQUFnQixLQUFBc0IsSUFBQUwsRUFBQXhDLGNDR1csSUFBSSIsImZpbGUiOiJiYm94LWFsaWduZWQtdGV4dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibW9kdWxlLmV4cG9ydHMgPSBCYm94QWxpZ25lZFRleHQ7XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhIG5ldyBCYm94QWxpZ25lZFRleHQgb2JqZWN0IC0gYSB0ZXh0IG9iamVjdCB0aGF0IGNhbiBiZSBkcmF3biB3aXRoXHJcbiAqIGFuY2hvciBwb2ludHMgYmFzZWQgb24gYSB0aWdodCBib3VuZGluZyBib3ggYXJvdW5kIHRoZSB0ZXh0LlxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQHBhcmFtIHtvYmplY3R9IGZvbnQgICAgICAgICAgICAgICBwNS5Gb250IG9iamVjdFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAgICAgICAgICAgICAgIFN0cmluZyB0byBkaXNwbGF5XHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBbZm9udFNpemU9MTJdICAgICAgRm9udCBzaXplIHRvIHVzZSBmb3Igc3RyaW5nXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBbcEluc3RhbmNlPXdpbmRvd10gUmVmZXJlbmNlIHRvIHA1IGluc3RhbmNlLCBsZWF2ZSBibGFuayBpZlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNrZXRjaCBpcyBnbG9iYWxcclxuICogQGV4YW1wbGVcclxuICogdmFyIGZvbnQsIGJib3hUZXh0O1xyXG4gKiBmdW5jdGlvbiBwcmVsb2FkKCkge1xyXG4gKiAgICAgZm9udCA9IGxvYWRGb250KFwiLi9hc3NldHMvUmVndWxhci50dGZcIik7XHJcbiAqIH1cclxuICogZnVuY3Rpb24gc2V0dXAoKSB7XHJcbiAqICAgICBjcmVhdGVDYW52YXMoNDAwLCA2MDApO1xyXG4gKiAgICAgYmFja2dyb3VuZCgwKTtcclxuICogICAgIFxyXG4gKiAgICAgYmJveFRleHQgPSBuZXcgQmJveEFsaWduZWRUZXh0KGZvbnQsIFwiSGV5IVwiLCAzMCk7ICAgIFxyXG4gKiAgICAgYmJveFRleHQuc2V0Um90YXRpb24oUEkgLyA0KTtcclxuICogICAgIGJib3hUZXh0LnNldEFuY2hvcihCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSLCBcclxuICogICAgICAgICAgICAgICAgICAgICAgICBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSKTtcclxuICogICAgIFxyXG4gKiAgICAgZmlsbChcIiMwMEE4RUFcIik7XHJcbiAqICAgICBub1N0cm9rZSgpO1xyXG4gKiAgICAgYmJveFRleHQuZHJhdyh3aWR0aCAvIDIsIGhlaWdodCAvIDIsIHRydWUpO1xyXG4gKiB9XHJcbiAqL1xyXG5mdW5jdGlvbiBCYm94QWxpZ25lZFRleHQoZm9udCwgdGV4dCwgZm9udFNpemUsIHBJbnN0YW5jZSkge1xyXG4gICAgdGhpcy5fZm9udCA9IGZvbnQ7XHJcbiAgICB0aGlzLl90ZXh0ID0gdGV4dDtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gKGZvbnRTaXplICE9PSB1bmRlZmluZWQpID8gZm9udFNpemUgOiAxMjtcclxuICAgIHRoaXMucCA9IHBJbnN0YW5jZSB8fCB3aW5kb3c7IC8vIElmIGluc3RhbmNlIGlzIG9taXR0ZWQsIGFzc3VtZSBnbG9iYWwgc2NvcGVcclxuICAgIHRoaXMuX3JvdGF0aW9uID0gMDtcclxuICAgIHRoaXMuX2hBbGlnbiA9IEJib3hBbGlnbmVkVGV4dC5BTElHTi5DRU5URVI7XHJcbiAgICB0aGlzLl92QWxpZ24gPSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSO1xyXG4gICAgdGhpcy5fY2FsY3VsYXRlTWV0cmljcyh0cnVlKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFZlcnRpY2FsIGFsaWdubWVudCB2YWx1ZXNcclxuICogQHB1YmxpY1xyXG4gKiBAc3RhdGljXHJcbiAqIEByZWFkb25seVxyXG4gKiBAZW51bSB7c3RyaW5nfVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LkFMSUdOID0ge1xyXG4gICAgLyoqIERyYXcgZnJvbSB0aGUgbGVmdCBvZiB0aGUgYmJveCAqL1xyXG4gICAgTEVGVDogXCJsZWZ0XCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGJib3ggKi9cclxuICAgIENFTlRFUjogXCJjZW50ZXJcIixcclxuICAgIC8qKiBEcmF3IGZyb20gdGhlIHJpZ2h0IG9mIHRoZSBiYm94ICovXHJcbiAgICBSSUdIVDogXCJyaWdodFwiXHJcbn07XHJcblxyXG4vKipcclxuICogQmFzZWxpbmUgYWxpZ25tZW50IHZhbHVlc1xyXG4gKiBAcHVibGljXHJcbiAqIEBzdGF0aWNcclxuICogQHJlYWRvbmx5XHJcbiAqIEBlbnVtIHtzdHJpbmd9XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQuQkFTRUxJTkUgPSB7XHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSB0b3Agb2YgdGhlIGJib3ggKi9cclxuICAgIEJPWF9UT1A6IFwidG9wXCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGJib3ggKi9cclxuICAgIEJPWF9DRU5URVI6IFwiY2VudGVyXCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBib3R0b20gb2YgdGhlIGJib3ggKi9cclxuICAgIEJPTV9CT1RUT006IFwiYm90dG9tXCIsXHJcbiAgICAvKiogXHJcbiAgICAgKiBEcmF3IGZyb20gaGFsZiB0aGUgaGVpZ2h0IG9mIHRoZSBmb250LiBTcGVjaWZpY2FsbHkgdGhlIGhlaWdodCBpc1xyXG4gICAgICogY2FsY3VsYXRlZCBhczogYXNjZW50ICsgZGVzY2VudC5cclxuICAgICAqL1xyXG4gICAgRk9OVF9DRU5URVI6IFwiZm9udF9jZW50ZXJcIixcclxuICAgIC8qKiBEcmF3IGZyb20gdGhlIHRoZSBub3JtYWwgZm9udCBiYXNlbGluZSAqL1xyXG4gICAgQUxQSEFCRVRJQzogXCJhbHBoYWJldGljXCJcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3VycmVudCB0ZXh0XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUZXh0IHN0cmluZyB0byBkaXNwbGF5XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFRleHQgPSBmdW5jdGlvbihzdHJpbmcpIHtcclxuICAgIHRoaXMuX3RleHQgPSBzdHJpbmc7XHJcbiAgICB0aGlzLl9jYWxjdWxhdGVNZXRyaWNzKGZhbHNlKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3VycmVudCB0ZXh0IHNpemVcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge251bWJlcn0gZm9udFNpemUgVGV4dCBzaXplXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFRleHRTaXplID0gZnVuY3Rpb24oZm9udFNpemUpIHtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gZm9udFNpemU7XHJcbiAgICB0aGlzLl9jYWxjdWxhdGVNZXRyaWNzKHRydWUpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCByb3RhdGlvbiBvZiB0ZXh0XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIFJvdGF0aW9uIGluIHJhZGlhbnNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0Um90YXRpb24gPSBmdW5jdGlvbihhbmdsZSkge1xyXG4gICAgdGhpcy5fcm90YXRpb24gPSBhbmdsZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgYW5jaG9yIHBvaW50IGZvciB0ZXh0IChob3Jpem9uYWwgYW5kIHZlcnRpY2FsIGFsaWdubWVudCkgcmVsYXRpdmUgdG9cclxuICogYm91bmRpbmcgYm94XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtzdHJpbmd9IFtoQWxpZ249Q0VOVEVSXSBIb3Jpem9uYWwgYWxpZ25tZW50XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBbdkFsaWduPUNFTlRFUl0gVmVydGljYWwgYmFzZWxpbmVcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0QW5jaG9yID0gZnVuY3Rpb24oaEFsaWduLCB2QWxpZ24pIHtcclxuICAgIHRoaXMuX2hBbGlnbiA9IGhBbGlnbiB8fCBCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSO1xyXG4gICAgdGhpcy5fdkFsaWduID0gdkFsaWduIHx8IEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5DRU5URVI7XHJcbn07XHJcblxyXG4vKipcclxuICogR2V0IHRoZSBib3VuZGluZyBib3ggd2hlbiB0aGUgdGV4dCBpcyBwbGFjZWQgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlcy5cclxuICogTm90ZTogdGhpcyBpcyB0aGUgdW5yb3RhdGVkIGJvdW5kaW5nIGJveCFcclxuICogQHBhcmFtICB7bnVtYmVyfSB4IFggY29vcmRpbmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgWSBjb29yZGluYXRlXHJcbiAqIEByZXR1cm4ge29iamVjdH0gICBSZXR1cm5zIGFuIG9iamVjdCB3aXRoIHByb3BlcnRpZXM6IHgsIHksIHcsIGhcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuZ2V0QmJveCA9IGZ1bmN0aW9uKHgsIHkpIHtcclxuICAgIHZhciBwb3MgPSB0aGlzLl9jYWxjdWxhdGVBbGlnbmVkQ29vcmRzKHgsIHkpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB4OiBwb3MueCArIHRoaXMuX2JvdW5kc09mZnNldC54LFxyXG4gICAgICAgIHk6IHBvcy55ICsgdGhpcy5fYm91bmRzT2Zmc2V0LnksXHJcbiAgICAgICAgdzogdGhpcy53aWR0aCxcclxuICAgICAgICBoOiB0aGlzLmhlaWdodFxyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBEcmF3cyB0aGUgdGV4dCBwYXJ0aWNsZSB3aXRoIHRoZSBzcGVjaWZpZWQgc3R5bGUgcGFyYW1ldGVyc1xyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSAge251bWJlcn0gIHggICAgICAgICAgICAgICAgICBYIGNvb3JkaW5hdGUgb2YgdGV4dCBhbmNob3JcclxuICogQHBhcmFtICB7bnVtYmVyfSAgeSAgICAgICAgICAgICAgICAgIFkgY29vcmRpbmF0ZSBvZiB0ZXh0IGFuY2hvclxyXG4gKiBAcGFyYW0gIHtib29sZWFufSBbZHJhd0JvdW5kcz1mYWxzZV0gRmxhZyBmb3IgZHJhd2luZyBib3VuZGluZyBib3hcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKHgsIHksIGRyYXdCb3VuZHMpIHtcclxuICAgIGRyYXdCb3VuZHMgPSBkcmF3Qm91bmRzIHx8IGZhbHNlO1xyXG4gICAgdmFyIHBvcyA9IHtcclxuICAgICAgICB4OiAoeCAhPT0gdW5kZWZpbmVkKSA/IHggOiAwLCBcclxuICAgICAgICB5OiAoeSAhPT0gdW5kZWZpbmVkKSA/IHkgOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucC5wdXNoKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9yb3RhdGlvbikge1xyXG4gICAgICAgICAgICBwb3MgPSB0aGlzLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzKHBvcy54LCBwb3MueSwgdGhpcy5fcm90YXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnAucm90YXRlKHRoaXMuX3JvdGF0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHBvcyA9IHRoaXMuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMocG9zLngsIHBvcy55KTtcclxuXHJcbiAgICAgICAgdGhpcy5wLnRleHRBbGlnbih0aGlzLnAuTEVGVCwgdGhpcy5wLkJBU0VMSU5FKTtcclxuICAgICAgICB0aGlzLnAudGV4dEZvbnQodGhpcy5fZm9udCk7XHJcbiAgICAgICAgdGhpcy5wLnRleHRTaXplKHRoaXMuX2ZvbnRTaXplKTtcclxuICAgICAgICB0aGlzLnAudGV4dCh0aGlzLl90ZXh0LCBwb3MueCwgcG9zLnkpO1xyXG5cclxuICAgICAgICBpZiAoZHJhd0JvdW5kcykge1xyXG4gICAgICAgICAgICB0aGlzLnAuc3Ryb2tlKDIwMCk7XHJcbiAgICAgICAgICAgIHZhciBib3VuZHNYID0gcG9zLnggKyB0aGlzLl9ib3VuZHNPZmZzZXQueDtcclxuICAgICAgICAgICAgdmFyIGJvdW5kc1kgPSBwb3MueSArIHRoaXMuX2JvdW5kc09mZnNldC55O1xyXG4gICAgICAgICAgICB0aGlzLnAubm9GaWxsKCk7XHJcbiAgICAgICAgICAgIHRoaXMucC5yZWN0KGJvdW5kc1gsIGJvdW5kc1ksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgdGhpcy5wLnBvcCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2plY3QgdGhlIGNvb3JkaW5hdGVzICh4LCB5KSBpbnRvIGEgcm90YXRlZCBjb29yZGluYXRlIHN5c3RlbVxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgIFggY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgICAgIFkgY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IGFuZ2xlIFJhZGlhbnMgb2Ygcm90YXRpb24gdG8gYXBwbHlcclxuICogQHJldHVybiB7b2JqZWN0fSAgICAgICBPYmplY3Qgd2l0aCB4ICYgeSBwcm9wZXJ0aWVzXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzID0gZnVuY3Rpb24gKHgsIHksIGFuZ2xlKSB7ICBcclxuICAgIHZhciByeCA9IE1hdGguY29zKGFuZ2xlKSAqIHggKyBNYXRoLmNvcyhNYXRoLlBJIC8gMiAtIGFuZ2xlKSAqIHk7XHJcbiAgICB2YXIgcnkgPSAtTWF0aC5zaW4oYW5nbGUpICogeCArIE1hdGguc2luKE1hdGguUEkgLyAyIC0gYW5nbGUpICogeTtcclxuICAgIHJldHVybiB7eDogcngsIHk6IHJ5fTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhdGVzIGRyYXcgY29vcmRpbmF0ZXMgZm9yIHRoZSB0ZXh0LCBhbGlnbmluZyBiYXNlZCBvbiB0aGUgYm91bmRpbmcgYm94LlxyXG4gKiBUaGUgdGV4dCBpcyBldmVudHVhbGx5IGRyYXduIHdpdGggY2FudmFzIGFsaWdubWVudCBzZXQgdG8gbGVmdCAmIGJhc2VsaW5lLCBzb1xyXG4gKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGEgZGVzaXJlZCBwb3MgJiBhbGlnbm1lbnQgYW5kIHJldHVybnMgdGhlIGFwcHJvcHJpYXRlXHJcbiAqIGNvb3JkaW5hdGVzIGZvciB0aGUgbGVmdCAmIGJhc2VsaW5lLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgICBYIGNvb3JkaW5hdGVcclxuICogQHBhcmFtICB7bnVtYmVyfSB5ICAgICAgWSBjb29yZGluYXRlXHJcbiAqIEByZXR1cm4ge29iamVjdH0gICAgICAgIE9iamVjdCB3aXRoIHggJiB5IHByb3BlcnRpZXNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMgPSBmdW5jdGlvbih4LCB5KSB7XHJcbiAgICB2YXIgbmV3WCwgbmV3WTtcclxuICAgIHN3aXRjaCAodGhpcy5faEFsaWduKSB7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uTEVGVDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkFMSUdOLkNFTlRFUjpcclxuICAgICAgICAgICAgbmV3WCA9IHggLSB0aGlzLmhhbGZXaWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uUklHSFQ6XHJcbiAgICAgICAgICAgIG5ld1ggPSB4IC0gdGhpcy53aWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pemVkIGhvcml6b25hbCBhbGlnbjpcIiwgdGhpcy5faEFsaWduKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKHRoaXMuX3ZBbGlnbikge1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLlRPUDpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9ib3VuZHNPZmZzZXQueTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSOlxyXG4gICAgICAgICAgICBuZXdZID0geSArIHRoaXMuX2Rpc3RCYXNlVG9NaWQ7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkJPVFRPTTpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9kaXN0QmFzZVRvQm90dG9tO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5GT05UX0NFTlRFUjpcclxuICAgICAgICAgICAgLy8gSGVpZ2h0IGlzIGFwcHJveGltYXRlZCBhcyBhc2NlbnQgKyBkZXNjZW50XHJcbiAgICAgICAgICAgIG5ld1kgPSB5IC0gdGhpcy5fZGVzY2VudCArICh0aGlzLl9hc2NlbnQgKyB0aGlzLl9kZXNjZW50KSAvIDI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkFMUEhBQkVUSUM6XHJcbiAgICAgICAgICAgIG5ld1kgPSB5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBuZXdZID0geTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgdmVydGljYWwgYWxpZ246XCIsIHRoaXMuX3ZBbGlnbik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHt4OiBuZXdYLCB5OiBuZXdZfTtcclxufTtcclxuXHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlcyBib3VuZGluZyBib3ggYW5kIHZhcmlvdXMgbWV0cmljcyBmb3IgdGhlIGN1cnJlbnQgdGV4dCBhbmQgZm9udFxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5fY2FsY3VsYXRlTWV0cmljcyA9IGZ1bmN0aW9uKHNob3VsZFVwZGF0ZUhlaWdodCkgeyAgXHJcbiAgICAvLyBwNSAwLjUuMCBoYXMgYSBidWcgLSB0ZXh0IGJvdW5kcyBhcmUgY2xpcHBlZCBieSAoMCwgMClcclxuICAgIC8vIENhbGN1bGF0aW5nIGJvdW5kcyBoYWNrXHJcbiAgICB2YXIgYm91bmRzID0gdGhpcy5fZm9udC50ZXh0Qm91bmRzKHRoaXMuX3RleHQsIDEwMDAsIDEwMDAsIHRoaXMuX2ZvbnRTaXplKTtcclxuICAgIGJvdW5kcy54IC09IDEwMDA7XHJcbiAgICBib3VuZHMueSAtPSAxMDAwO1xyXG5cclxuICAgIGlmIChzaG91bGRVcGRhdGVIZWlnaHQpIHtcclxuICAgICAgICB0aGlzLl9hc2NlbnQgPSB0aGlzLl9mb250Ll90ZXh0QXNjZW50KHRoaXMuX2ZvbnRTaXplKTtcclxuICAgICAgICB0aGlzLl9kZXNjZW50ID0gdGhpcy5fZm9udC5fdGV4dERlc2NlbnQodGhpcy5fZm9udFNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSBib3VuZHMgdG8gY2FsY3VsYXRlIGZvbnQgbWV0cmljc1xyXG4gICAgdGhpcy53aWR0aCA9IGJvdW5kcy53O1xyXG4gICAgdGhpcy5oZWlnaHQgPSBib3VuZHMuaDtcclxuICAgIHRoaXMuaGFsZldpZHRoID0gdGhpcy53aWR0aCAvIDI7XHJcbiAgICB0aGlzLmhhbGZIZWlnaHQgPSB0aGlzLmhlaWdodCAvIDI7XHJcbiAgICB0aGlzLl9ib3VuZHNPZmZzZXQgPSB7eDogYm91bmRzLngsIHk6IGJvdW5kcy55fTtcclxuICAgIHRoaXMuX2Rpc3RCYXNlVG9NaWQgPSBNYXRoLmFicyhib3VuZHMueSkgLSB0aGlzLmhhbGZIZWlnaHQ7XHJcbiAgICB0aGlzLl9kaXN0QmFzZVRvQm90dG9tID0gdGhpcy5oZWlnaHQgLSBNYXRoLmFicyhib3VuZHMueSk7XHJcbn07IiwiKGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09XCJvYmplY3RcIiYmdHlwZW9mIG1vZHVsZSE9PVwidW5kZWZpbmVkXCIpe21vZHVsZS5leHBvcnRzPWYoKX1lbHNlIGlmKHR5cGVvZiBkZWZpbmU9PT1cImZ1bmN0aW9uXCImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT1cInVuZGVmaW5lZFwiKXtnPXdpbmRvd31lbHNlIGlmKHR5cGVvZiBnbG9iYWwhPT1cInVuZGVmaW5lZFwiKXtnPWdsb2JhbH1lbHNlIGlmKHR5cGVvZiBzZWxmIT09XCJ1bmRlZmluZWRcIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuQmJveEFsaWduZWRUZXh0ID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xubW9kdWxlLmV4cG9ydHMgPSBCYm94QWxpZ25lZFRleHQ7XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhIG5ldyBCYm94QWxpZ25lZFRleHQgb2JqZWN0IC0gYSB0ZXh0IG9iamVjdCB0aGF0IGNhbiBiZSBkcmF3biB3aXRoXHJcbiAqIGFuY2hvciBwb2ludHMgYmFzZWQgb24gYSB0aWdodCBib3VuZGluZyBib3ggYXJvdW5kIHRoZSB0ZXh0LlxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQHBhcmFtIHtvYmplY3R9IGZvbnQgICAgICAgICAgICAgICBwNS5Gb250IG9iamVjdFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAgICAgICAgICAgICAgIFN0cmluZyB0byBkaXNwbGF5XHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBbZm9udFNpemU9MTJdICAgICAgRm9udCBzaXplIHRvIHVzZSBmb3Igc3RyaW5nXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBbcEluc3RhbmNlPXdpbmRvd10gUmVmZXJlbmNlIHRvIHA1IGluc3RhbmNlLCBsZWF2ZSBibGFuayBpZlxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNrZXRjaCBpcyBnbG9iYWxcclxuICogQGV4YW1wbGVcclxuICogdmFyIGZvbnQsIGJib3hUZXh0O1xyXG4gKiBmdW5jdGlvbiBwcmVsb2FkKCkge1xyXG4gKiAgICAgZm9udCA9IGxvYWRGb250KFwiLi9hc3NldHMvUmVndWxhci50dGZcIik7XHJcbiAqIH1cclxuICogZnVuY3Rpb24gc2V0dXAoKSB7XHJcbiAqICAgICBjcmVhdGVDYW52YXMoNDAwLCA2MDApO1xyXG4gKiAgICAgYmFja2dyb3VuZCgwKTtcclxuICogICAgIFxyXG4gKiAgICAgYmJveFRleHQgPSBuZXcgQmJveEFsaWduZWRUZXh0KGZvbnQsIFwiSGV5IVwiLCAzMCk7ICAgIFxyXG4gKiAgICAgYmJveFRleHQuc2V0Um90YXRpb24oUEkgLyA0KTtcclxuICogICAgIGJib3hUZXh0LnNldEFuY2hvcihCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSLCBcclxuICogICAgICAgICAgICAgICAgICAgICAgICBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSKTtcclxuICogICAgIFxyXG4gKiAgICAgZmlsbChcIiMwMEE4RUFcIik7XHJcbiAqICAgICBub1N0cm9rZSgpO1xyXG4gKiAgICAgYmJveFRleHQuZHJhdyh3aWR0aCAvIDIsIGhlaWdodCAvIDIsIHRydWUpO1xyXG4gKiB9XHJcbiAqL1xyXG5mdW5jdGlvbiBCYm94QWxpZ25lZFRleHQoZm9udCwgdGV4dCwgZm9udFNpemUsIHBJbnN0YW5jZSkge1xyXG4gICAgdGhpcy5fZm9udCA9IGZvbnQ7XHJcbiAgICB0aGlzLl90ZXh0ID0gdGV4dDtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gKGZvbnRTaXplICE9PSB1bmRlZmluZWQpID8gZm9udFNpemUgOiAxMjtcclxuICAgIHRoaXMucCA9IHBJbnN0YW5jZSB8fCB3aW5kb3c7IC8vIElmIGluc3RhbmNlIGlzIG9taXR0ZWQsIGFzc3VtZSBnbG9iYWwgc2NvcGVcclxuICAgIHRoaXMuX3JvdGF0aW9uID0gMDtcclxuICAgIHRoaXMuX2hBbGlnbiA9IEJib3hBbGlnbmVkVGV4dC5BTElHTi5DRU5URVI7XHJcbiAgICB0aGlzLl92QWxpZ24gPSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSO1xyXG4gICAgdGhpcy5fY2FsY3VsYXRlTWV0cmljcyh0cnVlKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFZlcnRpY2FsIGFsaWdubWVudCB2YWx1ZXNcclxuICogQHB1YmxpY1xyXG4gKiBAc3RhdGljXHJcbiAqIEByZWFkb25seVxyXG4gKiBAZW51bSB7c3RyaW5nfVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LkFMSUdOID0ge1xyXG4gICAgLyoqIERyYXcgZnJvbSB0aGUgbGVmdCBvZiB0aGUgYmJveCAqL1xyXG4gICAgTEVGVDogXCJsZWZ0XCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGJib3ggKi9cclxuICAgIENFTlRFUjogXCJjZW50ZXJcIixcclxuICAgIC8qKiBEcmF3IGZyb20gdGhlIHJpZ2h0IG9mIHRoZSBiYm94ICovXHJcbiAgICBSSUdIVDogXCJyaWdodFwiXHJcbn07XHJcblxyXG4vKipcclxuICogQmFzZWxpbmUgYWxpZ25tZW50IHZhbHVlc1xyXG4gKiBAcHVibGljXHJcbiAqIEBzdGF0aWNcclxuICogQHJlYWRvbmx5XHJcbiAqIEBlbnVtIHtzdHJpbmd9XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQuQkFTRUxJTkUgPSB7XHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSB0b3Agb2YgdGhlIGJib3ggKi9cclxuICAgIEJPWF9UT1A6IFwidG9wXCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBjZW50ZXIgb2YgdGhlIGJib3ggKi9cclxuICAgIEJPWF9DRU5URVI6IFwiY2VudGVyXCIsXHJcbiAgICAvKiogRHJhdyBmcm9tIHRoZSBib3R0b20gb2YgdGhlIGJib3ggKi9cclxuICAgIEJPTV9CT1RUT006IFwiYm90dG9tXCIsXHJcbiAgICAvKiogXHJcbiAgICAgKiBEcmF3IGZyb20gaGFsZiB0aGUgaGVpZ2h0IG9mIHRoZSBmb250LiBTcGVjaWZpY2FsbHkgdGhlIGhlaWdodCBpc1xyXG4gICAgICogY2FsY3VsYXRlZCBhczogYXNjZW50ICsgZGVzY2VudC5cclxuICAgICAqL1xyXG4gICAgRk9OVF9DRU5URVI6IFwiZm9udF9jZW50ZXJcIixcclxuICAgIC8qKiBEcmF3IGZyb20gdGhlIHRoZSBub3JtYWwgZm9udCBiYXNlbGluZSAqL1xyXG4gICAgQUxQSEFCRVRJQzogXCJhbHBoYWJldGljXCJcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3VycmVudCB0ZXh0XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUZXh0IHN0cmluZyB0byBkaXNwbGF5XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFRleHQgPSBmdW5jdGlvbihzdHJpbmcpIHtcclxuICAgIHRoaXMuX3RleHQgPSBzdHJpbmc7XHJcbiAgICB0aGlzLl9jYWxjdWxhdGVNZXRyaWNzKGZhbHNlKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3VycmVudCB0ZXh0IHNpemVcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge251bWJlcn0gZm9udFNpemUgVGV4dCBzaXplXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFRleHRTaXplID0gZnVuY3Rpb24oZm9udFNpemUpIHtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gZm9udFNpemU7XHJcbiAgICB0aGlzLl9jYWxjdWxhdGVNZXRyaWNzKHRydWUpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCByb3RhdGlvbiBvZiB0ZXh0XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIFJvdGF0aW9uIGluIHJhZGlhbnNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0Um90YXRpb24gPSBmdW5jdGlvbihhbmdsZSkge1xyXG4gICAgdGhpcy5fcm90YXRpb24gPSBhbmdsZTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgYW5jaG9yIHBvaW50IGZvciB0ZXh0IChob3Jpem9uYWwgYW5kIHZlcnRpY2FsIGFsaWdubWVudCkgcmVsYXRpdmUgdG9cclxuICogYm91bmRpbmcgYm94XHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtIHtzdHJpbmd9IFtoQWxpZ249Q0VOVEVSXSBIb3Jpem9uYWwgYWxpZ25tZW50XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBbdkFsaWduPUNFTlRFUl0gVmVydGljYWwgYmFzZWxpbmVcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0QW5jaG9yID0gZnVuY3Rpb24oaEFsaWduLCB2QWxpZ24pIHtcclxuICAgIHRoaXMuX2hBbGlnbiA9IGhBbGlnbiB8fCBCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSO1xyXG4gICAgdGhpcy5fdkFsaWduID0gdkFsaWduIHx8IEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5DRU5URVI7XHJcbn07XHJcblxyXG4vKipcclxuICogR2V0IHRoZSBib3VuZGluZyBib3ggd2hlbiB0aGUgdGV4dCBpcyBwbGFjZWQgYXQgdGhlIHNwZWNpZmllZCBjb29yZGluYXRlcy5cclxuICogTm90ZTogdGhpcyBpcyB0aGUgdW5yb3RhdGVkIGJvdW5kaW5nIGJveCFcclxuICogQHBhcmFtICB7bnVtYmVyfSB4IFggY29vcmRpbmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgWSBjb29yZGluYXRlXHJcbiAqIEByZXR1cm4ge29iamVjdH0gICBSZXR1cm5zIGFuIG9iamVjdCB3aXRoIHByb3BlcnRpZXM6IHgsIHksIHcsIGhcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuZ2V0QmJveCA9IGZ1bmN0aW9uKHgsIHkpIHtcclxuICAgIHZhciBwb3MgPSB0aGlzLl9jYWxjdWxhdGVBbGlnbmVkQ29vcmRzKHgsIHkpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB4OiBwb3MueCArIHRoaXMuX2JvdW5kc09mZnNldC54LFxyXG4gICAgICAgIHk6IHBvcy55ICsgdGhpcy5fYm91bmRzT2Zmc2V0LnksXHJcbiAgICAgICAgdzogdGhpcy53aWR0aCxcclxuICAgICAgICBoOiB0aGlzLmhlaWdodFxyXG4gICAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBEcmF3cyB0aGUgdGV4dCBwYXJ0aWNsZSB3aXRoIHRoZSBzcGVjaWZpZWQgc3R5bGUgcGFyYW1ldGVyc1xyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSAge251bWJlcn0gIHggICAgICAgICAgICAgICAgICBYIGNvb3JkaW5hdGUgb2YgdGV4dCBhbmNob3JcclxuICogQHBhcmFtICB7bnVtYmVyfSAgeSAgICAgICAgICAgICAgICAgIFkgY29vcmRpbmF0ZSBvZiB0ZXh0IGFuY2hvclxyXG4gKiBAcGFyYW0gIHtib29sZWFufSBbZHJhd0JvdW5kcz1mYWxzZV0gRmxhZyBmb3IgZHJhd2luZyBib3VuZGluZyBib3hcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKHgsIHksIGRyYXdCb3VuZHMpIHtcclxuICAgIGRyYXdCb3VuZHMgPSBkcmF3Qm91bmRzIHx8IGZhbHNlO1xyXG4gICAgdmFyIHBvcyA9IHtcclxuICAgICAgICB4OiAoeCAhPT0gdW5kZWZpbmVkKSA/IHggOiAwLCBcclxuICAgICAgICB5OiAoeSAhPT0gdW5kZWZpbmVkKSA/IHkgOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucC5wdXNoKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9yb3RhdGlvbikge1xyXG4gICAgICAgICAgICBwb3MgPSB0aGlzLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzKHBvcy54LCBwb3MueSwgdGhpcy5fcm90YXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnAucm90YXRlKHRoaXMuX3JvdGF0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHBvcyA9IHRoaXMuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMocG9zLngsIHBvcy55KTtcclxuXHJcbiAgICAgICAgdGhpcy5wLnRleHRBbGlnbih0aGlzLnAuTEVGVCwgdGhpcy5wLkJBU0VMSU5FKTtcclxuICAgICAgICB0aGlzLnAudGV4dEZvbnQodGhpcy5fZm9udCk7XHJcbiAgICAgICAgdGhpcy5wLnRleHRTaXplKHRoaXMuX2ZvbnRTaXplKTtcclxuICAgICAgICB0aGlzLnAudGV4dCh0aGlzLl90ZXh0LCBwb3MueCwgcG9zLnkpO1xyXG5cclxuICAgICAgICBpZiAoZHJhd0JvdW5kcykge1xyXG4gICAgICAgICAgICB0aGlzLnAuc3Ryb2tlKDIwMCk7XHJcbiAgICAgICAgICAgIHZhciBib3VuZHNYID0gcG9zLnggKyB0aGlzLl9ib3VuZHNPZmZzZXQueDtcclxuICAgICAgICAgICAgdmFyIGJvdW5kc1kgPSBwb3MueSArIHRoaXMuX2JvdW5kc09mZnNldC55O1xyXG4gICAgICAgICAgICB0aGlzLnAubm9GaWxsKCk7XHJcbiAgICAgICAgICAgIHRoaXMucC5yZWN0KGJvdW5kc1gsIGJvdW5kc1ksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgdGhpcy5wLnBvcCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2plY3QgdGhlIGNvb3JkaW5hdGVzICh4LCB5KSBpbnRvIGEgcm90YXRlZCBjb29yZGluYXRlIHN5c3RlbVxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgIFggY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgICAgIFkgY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IGFuZ2xlIFJhZGlhbnMgb2Ygcm90YXRpb24gdG8gYXBwbHlcclxuICogQHJldHVybiB7b2JqZWN0fSAgICAgICBPYmplY3Qgd2l0aCB4ICYgeSBwcm9wZXJ0aWVzXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzID0gZnVuY3Rpb24gKHgsIHksIGFuZ2xlKSB7ICBcclxuICAgIHZhciByeCA9IE1hdGguY29zKGFuZ2xlKSAqIHggKyBNYXRoLmNvcyhNYXRoLlBJIC8gMiAtIGFuZ2xlKSAqIHk7XHJcbiAgICB2YXIgcnkgPSAtTWF0aC5zaW4oYW5nbGUpICogeCArIE1hdGguc2luKE1hdGguUEkgLyAyIC0gYW5nbGUpICogeTtcclxuICAgIHJldHVybiB7eDogcngsIHk6IHJ5fTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhdGVzIGRyYXcgY29vcmRpbmF0ZXMgZm9yIHRoZSB0ZXh0LCBhbGlnbmluZyBiYXNlZCBvbiB0aGUgYm91bmRpbmcgYm94LlxyXG4gKiBUaGUgdGV4dCBpcyBldmVudHVhbGx5IGRyYXduIHdpdGggY2FudmFzIGFsaWdubWVudCBzZXQgdG8gbGVmdCAmIGJhc2VsaW5lLCBzb1xyXG4gKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGEgZGVzaXJlZCBwb3MgJiBhbGlnbm1lbnQgYW5kIHJldHVybnMgdGhlIGFwcHJvcHJpYXRlXHJcbiAqIGNvb3JkaW5hdGVzIGZvciB0aGUgbGVmdCAmIGJhc2VsaW5lLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgICBYIGNvb3JkaW5hdGVcclxuICogQHBhcmFtICB7bnVtYmVyfSB5ICAgICAgWSBjb29yZGluYXRlXHJcbiAqIEByZXR1cm4ge29iamVjdH0gICAgICAgIE9iamVjdCB3aXRoIHggJiB5IHByb3BlcnRpZXNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMgPSBmdW5jdGlvbih4LCB5KSB7XHJcbiAgICB2YXIgbmV3WCwgbmV3WTtcclxuICAgIHN3aXRjaCAodGhpcy5faEFsaWduKSB7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uTEVGVDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkFMSUdOLkNFTlRFUjpcclxuICAgICAgICAgICAgbmV3WCA9IHggLSB0aGlzLmhhbGZXaWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uUklHSFQ6XHJcbiAgICAgICAgICAgIG5ld1ggPSB4IC0gdGhpcy53aWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pemVkIGhvcml6b25hbCBhbGlnbjpcIiwgdGhpcy5faEFsaWduKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKHRoaXMuX3ZBbGlnbikge1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLlRPUDpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9ib3VuZHNPZmZzZXQueTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSOlxyXG4gICAgICAgICAgICBuZXdZID0geSArIHRoaXMuX2Rpc3RCYXNlVG9NaWQ7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkJPVFRPTTpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9kaXN0QmFzZVRvQm90dG9tO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5GT05UX0NFTlRFUjpcclxuICAgICAgICAgICAgLy8gSGVpZ2h0IGlzIGFwcHJveGltYXRlZCBhcyBhc2NlbnQgKyBkZXNjZW50XHJcbiAgICAgICAgICAgIG5ld1kgPSB5IC0gdGhpcy5fZGVzY2VudCArICh0aGlzLl9hc2NlbnQgKyB0aGlzLl9kZXNjZW50KSAvIDI7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkFMUEhBQkVUSUM6XHJcbiAgICAgICAgICAgIG5ld1kgPSB5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBuZXdZID0geTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgdmVydGljYWwgYWxpZ246XCIsIHRoaXMuX3ZBbGlnbik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHt4OiBuZXdYLCB5OiBuZXdZfTtcclxufTtcclxuXHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlcyBib3VuZGluZyBib3ggYW5kIHZhcmlvdXMgbWV0cmljcyBmb3IgdGhlIGN1cnJlbnQgdGV4dCBhbmQgZm9udFxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5fY2FsY3VsYXRlTWV0cmljcyA9IGZ1bmN0aW9uKHNob3VsZFVwZGF0ZUhlaWdodCkgeyAgXHJcbiAgICAvLyBwNSAwLjUuMCBoYXMgYSBidWcgLSB0ZXh0IGJvdW5kcyBhcmUgY2xpcHBlZCBieSAoMCwgMClcclxuICAgIC8vIENhbGN1bGF0aW5nIGJvdW5kcyBoYWNrXHJcbiAgICB2YXIgYm91bmRzID0gdGhpcy5fZm9udC50ZXh0Qm91bmRzKHRoaXMuX3RleHQsIDEwMDAsIDEwMDAsIHRoaXMuX2ZvbnRTaXplKTtcclxuICAgIGJvdW5kcy54IC09IDEwMDA7XHJcbiAgICBib3VuZHMueSAtPSAxMDAwO1xyXG5cclxuICAgIGlmIChzaG91bGRVcGRhdGVIZWlnaHQpIHtcclxuICAgICAgICB0aGlzLl9hc2NlbnQgPSB0aGlzLl9mb250Ll90ZXh0QXNjZW50KHRoaXMuX2ZvbnRTaXplKTtcclxuICAgICAgICB0aGlzLl9kZXNjZW50ID0gdGhpcy5fZm9udC5fdGV4dERlc2NlbnQodGhpcy5fZm9udFNpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVzZSBib3VuZHMgdG8gY2FsY3VsYXRlIGZvbnQgbWV0cmljc1xyXG4gICAgdGhpcy53aWR0aCA9IGJvdW5kcy53O1xyXG4gICAgdGhpcy5oZWlnaHQgPSBib3VuZHMuaDtcclxuICAgIHRoaXMuaGFsZldpZHRoID0gdGhpcy53aWR0aCAvIDI7XHJcbiAgICB0aGlzLmhhbGZIZWlnaHQgPSB0aGlzLmhlaWdodCAvIDI7XHJcbiAgICB0aGlzLl9ib3VuZHNPZmZzZXQgPSB7eDogYm91bmRzLngsIHk6IGJvdW5kcy55fTtcclxuICAgIHRoaXMuX2Rpc3RCYXNlVG9NaWQgPSBNYXRoLmFicyhib3VuZHMueSkgLSB0aGlzLmhhbGZIZWlnaHQ7XHJcbiAgICB0aGlzLl9kaXN0QmFzZVRvQm90dG9tID0gdGhpcy5oZWlnaHQgLSBNYXRoLmFicyhib3VuZHMueSk7XHJcbn07XG59LHt9XX0se30sWzFdKSgxKVxufSk7XG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
