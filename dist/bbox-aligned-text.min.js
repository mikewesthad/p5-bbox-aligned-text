!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.BboxAlignedText=t()}}(function(){return function t(i,e,o){function s(h,r){if(!e[h]){if(!i[h]){var a="function"==typeof require&&require;if(!r&&a)return a(h,!0);if(n)return n(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var c=e[h]={exports:{}};i[h][0].call(c.exports,function(t){var e=i[h][1][t];return s(e?e:t)},c,c.exports,t,i,e,o)}return e[h].exports}for(var n="function"==typeof require&&require,h=0;h<o.length;h++)s(o[h]);return s}({1:[function(t,i,e){function o(t,i,e,s){this._font=t,this._text=i,this._fontSize=void 0!==e?e:12,this.p=s||window,this._rotation=0,this._hAlign=o.ALIGN.CENTER,this._vAlign=o.BASELINE.CENTER,this._calculateMetrics()}i.exports=o,o.ALIGN={LEFT:"left",CENTER:"center",RIGHT:"right"},o.BASELINE={TOP:"top",CENTER:"center",ALPHABETIC:"alphabetic",BOTTOM:"bottom"},o.prototype.setText=function(t){this._text=t,this._calculateMetrics()},o.prototype.setTextSize=function(t){this._fontSize=t,this._calculateMetrics()},o.prototype.setRotation=function(t){this._rotation=t},o.prototype.setAnchor=function(t,i){this._hAlign=t||o.ALIGN.CENTER,this._vAlign=i||o.BASELINE.CENTER},o.prototype.draw=function(t,i,e){e=e||!1;var o={x:void 0!==t?t:0,y:void 0!==i?i:0};if(this.p.push(),this._rotation&&(o=this._calculateRotatedCoords(o.x,o.y,this._rotation),this.p.rotate(this._rotation)),o=this._calculateAlignedCoords(o.x,o.y),this.p.textAlign(this.p.LEFT,this.p.BASELINE),this.p.textFont(this._font),this.p.textSize(this._fontSize),this.p.text(this._text,o.x,o.y),e){this.p.stroke(200);var s=o.x+this._boundsOffset.x,n=o.y+this._boundsOffset.y;this.p.noFill(),this.p.rect(s,n,this.width,this.height)}this.p.pop()},o.prototype._calculateRotatedCoords=function(t,i,e){var o=Math.cos(e)*t+Math.cos(Math.PI/2-e)*i,s=-Math.sin(e)*t+Math.sin(Math.PI/2-e)*i;return{x:o,y:s}},o.prototype._calculateAlignedCoords=function(t,i){var e,s;switch(this._hAlign){case o.ALIGN.LEFT:e=t;break;case o.ALIGN.CENTER:e=t-this.halfWidth;break;case o.ALIGN.RIGHT:e=t-this.width;break;default:e=t,console.log("Unrecognized horizonal align:",this._hAlign)}switch(this._vAlign){case o.BASELINE.TOP:s=i-this._boundsOffset.y;break;case o.BASELINE.CENTER:s=i+this._distBaseToMid;break;case o.BASELINE.BOTTOM:s=i-this._distBaseToBottom;break;case o.BASELINE.ALPHABETIC:s=i;break;default:s=i,console.log("Unrecognized vertical align:",this._vAlign)}return{x:e,y:s}},o.prototype._calculateMetrics=function(){var t=this._font.textBounds(this._text,1e3,1e3,this._fontSize);t.x-=1e3,t.y-=1e3,this.width=t.w,this.height=t.h,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this._boundsOffset={x:t.x,y:t.y},this._distBaseToMid=Math.abs(t.y)-this.halfHeight,this._distBaseToBottom=this.height-Math.abs(t.y)}},{}]},{},[1])(1)});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJsaWIvYmJveC1hbGlnbmVkLXRleHQuanMiLCJiYm94LWFsaWduZWQtdGV4dC5qcyJdLCJuYW1lcyI6WyJmIiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsImciLCJ3aW5kb3ciLCJnbG9iYWwiLCJzZWxmIiwidGhpcyIsIkJib3hBbGlnbmVkVGV4dCIsImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJFcnJvciIsImNvZGUiLCJsIiwiY2FsbCIsImxlbmd0aCIsIjEiLCJmb250IiwidGV4dCIsImZvbnRTaXplIiwicEluc3RhbmNlIiwiX2ZvbnQiLCJfdGV4dCIsIl9mb250U2l6ZSIsInVuZGVmaW5lZCIsInAiLCJfcm90YXRpb24iLCJfaEFsaWduIiwiQUxJR04iLCJDRU5URVIiLCJfdkFsaWduIiwiQkFTRUxJTkUiLCJfY2FsY3VsYXRlTWV0cmljcyIsIkxFRlQiLCJSSUdIVCIsIlRPUCIsIkFMUEhBQkVUSUMiLCJCT1RUT00iLCJwcm90b3R5cGUiLCJzZXRUZXh0Iiwic3RyaW5nIiwic2V0VGV4dFNpemUiLCJzZXRSb3RhdGlvbiIsImFuZ2xlIiwic2V0QW5jaG9yIiwiaEFsaWduIiwidkFsaWduIiwiZHJhdyIsIngiLCJ5IiwiZHJhd0JvdW5kcyIsInBvcyIsInB1c2giLCJfY2FsY3VsYXRlUm90YXRlZENvb3JkcyIsInJvdGF0ZSIsIl9jYWxjdWxhdGVBbGlnbmVkQ29vcmRzIiwidGV4dEFsaWduIiwidGV4dEZvbnQiLCJ0ZXh0U2l6ZSIsInN0cm9rZSIsImJvdW5kc1giLCJfYm91bmRzT2Zmc2V0IiwiYm91bmRzWSIsIm5vRmlsbCIsInJlY3QiLCJ3aWR0aCIsImhlaWdodCIsInBvcCIsInJ4IiwiTWF0aCIsImNvcyIsIlBJIiwicnkiLCJzaW4iLCJuZXdYIiwibmV3WSIsImhhbGZXaWR0aCIsImNvbnNvbGUiLCJsb2ciLCJfZGlzdEJhc2VUb01pZCIsIl9kaXN0QmFzZVRvQm90dG9tIiwiYm91bmRzIiwidGV4dEJvdW5kcyIsInciLCJoIiwiaGFsZkhlaWdodCIsImFicyJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsR0FBQSxHQUFBLGdCQUFBQyxVQUFBLG1CQUFBQyxRQUFBQSxPQUFBRCxRQUFBRCxRQUFBLElBQUEsa0JBQUFHLFNBQUFBLE9BQUFDLElBQUFELFVBQUFILE9BQUEsQ0FBQSxHQUFBSyxFQUFBQSxHQUFBLG1CQUFBQyxRQUFBQSxPQUFBLG1CQUFBQyxRQUFBQSxPQUFBLG1CQUFBQyxNQUFBQSxLQUFBQyxLQUFBSixFQUFBSyxnQkFBQVYsTUFBQSxXQUFBLE1BQUEsU0FBQVcsR0FBQUMsRUFBQUMsRUFBQUMsR0FBQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUFBLElBQUFKLEVBQUFHLEdBQUEsQ0FBQSxJQUFBSixFQUFBSSxHQUFBLENBQUEsR0FBQUUsR0FBQSxrQkFBQUMsVUFBQUEsT0FBQSxLQUFBRixHQUFBQyxFQUFBLE1BQUFBLEdBQUFGLEdBQUEsRUFBQSxJQUFBSSxFQUFBLE1BQUFBLEdBQUFKLEdBQUEsRUFBQSxJQUFBaEIsR0FBQSxHQUFBcUIsT0FBQSx1QkFBQUwsRUFBQSxJQUFBLE1BQUFoQixHQUFBc0IsS0FBQSxtQkFBQXRCLEVBQUEsR0FBQXVCLEdBQUFWLEVBQUFHLElBQUFmLFdBQUFXLEdBQUFJLEdBQUEsR0FBQVEsS0FBQUQsRUFBQXRCLFFBQUEsU0FBQVUsR0FBQSxHQUFBRSxHQUFBRCxFQUFBSSxHQUFBLEdBQUFMLEVBQUEsT0FBQUksR0FBQUYsRUFBQUEsRUFBQUYsSUFBQVksRUFBQUEsRUFBQXRCLFFBQUFVLEVBQUFDLEVBQUFDLEVBQUFDLEdBQUEsTUFBQUQsR0FBQUcsR0FBQWYsUUFBQSxJQUFBLEdBQUFtQixHQUFBLGtCQUFBRCxVQUFBQSxRQUFBSCxFQUFBLEVBQUFBLEVBQUFGLEVBQUFXLE9BQUFULElBQUFELEVBQUFELEVBQUFFLEdBQUEs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VyxJQUFJIiwiZmlsZSI6ImJib3gtYWxpZ25lZC10ZXh0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IEJib3hBbGlnbmVkVGV4dDtcclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGEgbmV3IEJib3hBbGlnbmVkVGV4dCBvYmplY3QgLSBhIHRleHQgb2JqZWN0IHRoYXQgY2FuIGJlIGRyYXduIHdpdGhcclxuICogYW5jaG9yIHBvaW50cyBiYXNlZCBvbiBhIHRpZ2h0IGJvdW5kaW5nIGJveFxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQHBhcmFtIHtvYmplY3R9ICAgICAgICAgICAgICAgZm9udCAgICAgICAgICAgICAgIHA1LkZvbnQgb2JqZWN0XHJcbiAqIEBwYXJhbSB7c3RyaW5nfSAgICAgICAgICAgICAgIHRleHQgICAgICAgICAgICAgICBzdHJpbmcgdG8gZGlzcGxheVxyXG4gKiBAcGFyYW0ge251bWJlcn0gICAgICAgICAgICAgICBbZm9udFNpemU9MTJdICAgICAgZm9udCBzaXplIHRvIHVzZSBmb3Igc3RyaW5nXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSAgICAgICAgICAgICAgIFtwSW5zdGFuY2U9d2luZG93XSByZWZlcmVuY2UgdG8gcDUgaW5zdGFuY2UsIFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhdmUgYmxhbmsgaWYgc2tldGNoIGlzIFxyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsXHJcbiAqL1xyXG5mdW5jdGlvbiBCYm94QWxpZ25lZFRleHQoZm9udCwgdGV4dCwgZm9udFNpemUsIHBJbnN0YW5jZSkge1xyXG4gICAgdGhpcy5fZm9udCA9IGZvbnQ7XHJcbiAgICB0aGlzLl90ZXh0ID0gdGV4dDtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gKGZvbnRTaXplICE9PSB1bmRlZmluZWQpID8gZm9udFNpemUgOiAxMjtcclxuICAgIHRoaXMucCA9IHBJbnN0YW5jZSB8fCB3aW5kb3c7IC8vIElmIGluc3RhbmNlIGlzIG9taXR0ZWQsIGFzc3VtZSBnbG9iYWwgc2NvcGVcclxuICAgIHRoaXMuX3JvdGF0aW9uID0gMDtcclxuICAgIHRoaXMuX2hBbGlnbiA9IEJib3hBbGlnbmVkVGV4dC5BTElHTi5DRU5URVI7XHJcbiAgICB0aGlzLl92QWxpZ24gPSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSO1xyXG4gICAgdGhpcy5fY2FsY3VsYXRlTWV0cmljcygpO1xyXG59XHJcblxyXG4vKipcclxuICogVmVydGljYWwgYWxpZ25tZW50IHZhbHVlc1xyXG4gKiBAcHVibGljXHJcbiAqIEBzdGF0aWNcclxuICogQHJlYWRvbmx5XHJcbiAqIEBlbnVtIHtzdHJpbmd9XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQuQUxJR04gPSB7XHJcbiAgICBMRUZUOiBcImxlZnRcIixcclxuICAgIENFTlRFUjogXCJjZW50ZXJcIixcclxuICAgIFJJR0hUOiBcInJpZ2h0XCJcclxufTtcclxuXHJcbi8qKlxyXG4gKiBCYXNlbGluZSBhbGlnbm1lbnQgdmFsdWVzXHJcbiAqIEBwdWJsaWNcclxuICogQHN0YXRpY1xyXG4gKiBAcmVhZG9ubHlcclxuICogQGVudW0ge3N0cmluZ31cclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5CQVNFTElORSA9IHtcclxuICAgIFRPUDogXCJ0b3BcIixcclxuICAgIENFTlRFUjogXCJjZW50ZXJcIixcclxuICAgIEFMUEhBQkVUSUM6IFwiYWxwaGFiZXRpY1wiLFxyXG4gICAgQk9UVE9NOiBcImJvdHRvbVwiXHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IGN1cnJlbnQgdGV4dFxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmcgdGV4dCBzdHJpbmcgdG8gZGlzcGxheVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5zZXRUZXh0ID0gZnVuY3Rpb24oc3RyaW5nKSB7XHJcbiAgICB0aGlzLl90ZXh0ID0gc3RyaW5nO1xyXG4gICAgdGhpcy5fY2FsY3VsYXRlTWV0cmljcygpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdXJyZW50IHRleHQgc2l6ZVxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBmb250U2l6ZSB0ZXh0IHNpemVcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0VGV4dFNpemUgPSBmdW5jdGlvbihmb250U2l6ZSkge1xyXG4gICAgdGhpcy5fZm9udFNpemUgPSBmb250U2l6ZTtcclxuICAgIHRoaXMuX2NhbGN1bGF0ZU1ldHJpY3MoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgcm90YXRpb24gb2YgdGV4dFxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSByb3RhdGlvbiBpbiByYWRpYW5zXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFJvdGF0aW9uID0gZnVuY3Rpb24oYW5nbGUpIHtcclxuICAgIHRoaXMuX3JvdGF0aW9uID0gYW5nbGU7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IGFuY2hvciBwb2ludCBmb3IgdGV4dCAoaG9yaXpvbmFsIGFuZCB2ZXJ0aWNhbCBhbGlnbm1lbnQpIHJlbGF0aXZlIHRvXHJcbiAqIGJvdW5kaW5nIGJveFxyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBbaEFsaWduPUNFTlRFUl0gaG9yaXpvbmFsIGFsaWdubWVudFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gW3ZBbGlnbj1DRU5URVJdIHZlcnRpY2FsIGJhc2VsaW5lXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldEFuY2hvciA9IGZ1bmN0aW9uKGhBbGlnbiwgdkFsaWduKSB7XHJcbiAgICB0aGlzLl9oQWxpZ24gPSBoQWxpZ24gfHwgQmJveEFsaWduZWRUZXh0LkFMSUdOLkNFTlRFUjtcclxuICAgIHRoaXMuX3ZBbGlnbiA9IHZBbGlnbiB8fCBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIERyYXdzIHRoZSB0ZXh0IHBhcnRpY2xlIHdpdGggdGhlIHNwZWNpZmllZCBzdHlsZSBwYXJhbWV0ZXJzXHJcbiAqIEBwdWJsaWNcclxuICogQHBhcmFtICB7bnVtYmVyfSAgeCAgICAgICAgICAgICAgICAgIHggY29vcmRpbmF0ZSBvZiB0ZXh0IGFuY2hvclxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9ICB5ICAgICAgICAgICAgICAgICAgeSBjb29yZGluYXRlIG9mIHRleHQgYW5jaG9yXHJcbiAqIEBwYXJhbSAge2Jvb2xlYW59IFtkcmF3Qm91bmRzPWZhbHNlXSBmbGFnIGZvciBkcmF3aW5nIGJvdW5kaW5nIGJveFxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24oeCwgeSwgZHJhd0JvdW5kcykge1xyXG4gICAgZHJhd0JvdW5kcyA9IGRyYXdCb3VuZHMgfHwgZmFsc2U7XHJcbiAgICB2YXIgcG9zID0ge1xyXG4gICAgICAgIHg6ICh4ICE9PSB1bmRlZmluZWQpID8geCA6IDAsIFxyXG4gICAgICAgIHk6ICh5ICE9PSB1bmRlZmluZWQpID8geSA6IDBcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5wLnB1c2goKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX3JvdGF0aW9uKSB7XHJcbiAgICAgICAgICAgIHBvcyA9IHRoaXMuX2NhbGN1bGF0ZVJvdGF0ZWRDb29yZHMocG9zLngsIHBvcy55LCB0aGlzLl9yb3RhdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMucC5yb3RhdGUodGhpcy5fcm90YXRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcG9zID0gdGhpcy5fY2FsY3VsYXRlQWxpZ25lZENvb3Jkcyhwb3MueCwgcG9zLnkpO1xyXG5cclxuICAgICAgICB0aGlzLnAudGV4dEFsaWduKHRoaXMucC5MRUZULCB0aGlzLnAuQkFTRUxJTkUpO1xyXG4gICAgICAgIHRoaXMucC50ZXh0Rm9udCh0aGlzLl9mb250KTtcclxuICAgICAgICB0aGlzLnAudGV4dFNpemUodGhpcy5fZm9udFNpemUpO1xyXG4gICAgICAgIHRoaXMucC50ZXh0KHRoaXMuX3RleHQsIHBvcy54LCBwb3MueSk7XHJcblxyXG4gICAgICAgIGlmIChkcmF3Qm91bmRzKSB7XHJcbiAgICAgICAgICAgIHRoaXMucC5zdHJva2UoMjAwKTtcclxuICAgICAgICAgICAgdmFyIGJvdW5kc1ggPSBwb3MueCArIHRoaXMuX2JvdW5kc09mZnNldC54O1xyXG4gICAgICAgICAgICB2YXIgYm91bmRzWSA9IHBvcy55ICsgdGhpcy5fYm91bmRzT2Zmc2V0Lnk7XHJcbiAgICAgICAgICAgIHRoaXMucC5ub0ZpbGwoKTtcclxuICAgICAgICAgICAgdGhpcy5wLnJlY3QoYm91bmRzWCwgYm91bmRzWSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICB0aGlzLnAucG9wKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvamVjdCB0aGUgY29vcmRpbmF0ZXMgKHgsIHkpIGludG8gYSByb3RhdGVkIGNvb3JkaW5hdGUgc3lzdGVtXHJcbiAqIEBwcml2YXRlXHJcbiAqIEBwYXJhbSAge251bWJlcn0geCAgICAgeCBjb29yZGluYXRlIChpbiB1bnJvdGF0ZWQgc3BhY2UpXHJcbiAqIEBwYXJhbSAge251bWJlcn0geSAgICAgeSBjb29yZGluYXRlIChpbiB1bnJvdGF0ZWQgc3BhY2UpXHJcbiAqIEBwYXJhbSAge251bWJlcn0gYW5nbGUgcmFkaWFucyBvZiByb3RhdGlvbiB0byBhcHBseVxyXG4gKiBAcmV0dXJuIHtvYmplY3R9ICAgICAgIG9iamVjdCB3aXRoIHggJiB5IHByb3BlcnRpZXNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuX2NhbGN1bGF0ZVJvdGF0ZWRDb29yZHMgPSBmdW5jdGlvbiAoeCwgeSwgYW5nbGUpIHsgIFxyXG4gICAgdmFyIHJ4ID0gTWF0aC5jb3MoYW5nbGUpICogeCArIE1hdGguY29zKE1hdGguUEkgLyAyIC0gYW5nbGUpICogeTtcclxuICAgIHZhciByeSA9IC1NYXRoLnNpbihhbmdsZSkgKiB4ICsgTWF0aC5zaW4oTWF0aC5QSSAvIDIgLSBhbmdsZSkgKiB5O1xyXG4gICAgcmV0dXJuIHt4OiByeCwgeTogcnl9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENhbGN1bGF0ZXMgZHJhdyBjb29yZGluYXRlcyBmb3IgdGhlIHRleHQsIGFsaWduaW5nIGJhc2VkIG9uIHRoZSBib3VuZGluZyBib3guXHJcbiAqIFRoZSB0ZXh0IGlzIGV2ZW50dWFsbHkgZHJhd24gd2l0aCBjYW52YXMgYWxpZ25tZW50IHNldCB0byBsZWZ0ICYgYmFzZWxpbmUsIHNvXHJcbiAqIHRoaXMgZnVuY3Rpb24gdGFrZXMgYSBkZXNpcmVkIHBvcyAmIGFsaWdubWVudCBhbmQgcmV0dXJucyB0aGUgYXBwcm9wcmlhdGVcclxuICogY29vcmRpbmF0ZXMgZm9yIHRoZSBsZWZ0ICYgYmFzZWxpbmUuXHJcbiAqIEBwcml2YXRlXHJcbiAqIEBwYXJhbSAge251bWJlcn0geCAgICAgIHggY29vcmRpbmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgICAgICB5IGNvb3JkaW5hdGVcclxuICogQHJldHVybiB7b2JqZWN0fSAgICAgICAgb2JqZWN0IHdpdGggeCAmIHkgcHJvcGVydGllc1xyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5fY2FsY3VsYXRlQWxpZ25lZENvb3JkcyA9IGZ1bmN0aW9uKHgsIHkpIHtcclxuICAgIHZhciBuZXdYLCBuZXdZO1xyXG4gICAgc3dpdGNoICh0aGlzLl9oQWxpZ24pIHtcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5BTElHTi5MRUZUOlxyXG4gICAgICAgICAgICBuZXdYID0geDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSOlxyXG4gICAgICAgICAgICBuZXdYID0geCAtIHRoaXMuaGFsZldpZHRoO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5BTElHTi5SSUdIVDpcclxuICAgICAgICAgICAgbmV3WCA9IHggLSB0aGlzLndpZHRoO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBuZXdYID0geDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgaG9yaXpvbmFsIGFsaWduOlwiLCB0aGlzLl9oQWxpZ24pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHN3aXRjaCAodGhpcy5fdkFsaWduKSB7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuVE9QOlxyXG4gICAgICAgICAgICBuZXdZID0geSAtIHRoaXMuX2JvdW5kc09mZnNldC55O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5DRU5URVI6XHJcbiAgICAgICAgICAgIG5ld1kgPSB5ICsgdGhpcy5fZGlzdEJhc2VUb01pZDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQk9UVE9NOlxyXG4gICAgICAgICAgICBuZXdZID0geSAtIHRoaXMuX2Rpc3RCYXNlVG9Cb3R0b207XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkFMUEhBQkVUSUM6XHJcbiAgICAgICAgICAgIG5ld1kgPSB5O1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBuZXdZID0geTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbnJlY29nbml6ZWQgdmVydGljYWwgYWxpZ246XCIsIHRoaXMuX3ZBbGlnbik7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHt4OiBuZXdYLCB5OiBuZXdZfTtcclxufTtcclxuXHJcblxyXG4vKipcclxuICogQ2FsY3VsYXRlcyBib3VuZGluZyBib3ggYW5kIHZhcmlvdXMgbWV0cmljcyBmb3IgdGhlIGN1cnJlbnQgdGV4dCBhbmQgZm9udFxyXG4gKiBAcHJpdmF0ZVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5fY2FsY3VsYXRlTWV0cmljcyA9IGZ1bmN0aW9uKCkgeyAgXHJcbiAgICAvLyBwNSAwLjUuMCBoYXMgYSBidWcgLSB0ZXh0IGJvdW5kcyBhcmUgY2xpcHBlZCBieSAoMCwgMClcclxuICAgIC8vIENhbGN1bGF0aW5nIGJvdW5kcyBoYWNrXHJcbiAgICB2YXIgYm91bmRzID0gdGhpcy5fZm9udC50ZXh0Qm91bmRzKHRoaXMuX3RleHQsIDEwMDAsIDEwMDAsIHRoaXMuX2ZvbnRTaXplKTtcclxuICAgIGJvdW5kcy54IC09IDEwMDA7XHJcbiAgICBib3VuZHMueSAtPSAxMDAwO1xyXG5cclxuICAgIC8vIFVzZSBib3VuZHMgdG8gY2FsY3VsYXRlIGZvbnQgbWV0cmljc1xyXG4gICAgdGhpcy53aWR0aCA9IGJvdW5kcy53O1xyXG4gICAgdGhpcy5oZWlnaHQgPSBib3VuZHMuaDtcclxuICAgIHRoaXMuaGFsZldpZHRoID0gdGhpcy53aWR0aCAvIDI7XHJcbiAgICB0aGlzLmhhbGZIZWlnaHQgPSB0aGlzLmhlaWdodCAvIDI7XHJcbiAgICB0aGlzLl9ib3VuZHNPZmZzZXQgPSB7eDogYm91bmRzLngsIHk6IGJvdW5kcy55fTtcclxuICAgIHRoaXMuX2Rpc3RCYXNlVG9NaWQgPSBNYXRoLmFicyhib3VuZHMueSkgLSB0aGlzLmhhbGZIZWlnaHQ7XHJcbiAgICB0aGlzLl9kaXN0QmFzZVRvQm90dG9tID0gdGhpcy5oZWlnaHQgLSBNYXRoLmFicyhib3VuZHMueSk7XHJcbn07IiwiKGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09XCJvYmplY3RcIiYmdHlwZW9mIG1vZHVsZSE9PVwidW5kZWZpbmVkXCIpe21vZHVsZS5leHBvcnRzPWYoKX1lbHNlIGlmKHR5cGVvZiBkZWZpbmU9PT1cImZ1bmN0aW9uXCImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT1cInVuZGVmaW5lZFwiKXtnPXdpbmRvd31lbHNlIGlmKHR5cGVvZiBnbG9iYWwhPT1cInVuZGVmaW5lZFwiKXtnPWdsb2JhbH1lbHNlIGlmKHR5cGVvZiBzZWxmIT09XCJ1bmRlZmluZWRcIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuQmJveEFsaWduZWRUZXh0ID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xubW9kdWxlLmV4cG9ydHMgPSBCYm94QWxpZ25lZFRleHQ7XHJcblxyXG4vKipcclxuICogQ3JlYXRlcyBhIG5ldyBCYm94QWxpZ25lZFRleHQgb2JqZWN0IC0gYSB0ZXh0IG9iamVjdCB0aGF0IGNhbiBiZSBkcmF3biB3aXRoXHJcbiAqIGFuY2hvciBwb2ludHMgYmFzZWQgb24gYSB0aWdodCBib3VuZGluZyBib3hcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSAgICAgICAgICAgICAgIGZvbnQgICAgICAgICAgICAgICBwNS5Gb250IG9iamVjdFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gICAgICAgICAgICAgICB0ZXh0ICAgICAgICAgICAgICAgc3RyaW5nIHRvIGRpc3BsYXlcclxuICogQHBhcmFtIHtudW1iZXJ9ICAgICAgICAgICAgICAgW2ZvbnRTaXplPTEyXSAgICAgIGZvbnQgc2l6ZSB0byB1c2UgZm9yIHN0cmluZ1xyXG4gKiBAcGFyYW0ge29iamVjdH0gICAgICAgICAgICAgICBbcEluc3RhbmNlPXdpbmRvd10gcmVmZXJlbmNlIHRvIHA1IGluc3RhbmNlLCBcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXZlIGJsYW5rIGlmIHNrZXRjaCBpcyBcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbFxyXG4gKi9cclxuZnVuY3Rpb24gQmJveEFsaWduZWRUZXh0KGZvbnQsIHRleHQsIGZvbnRTaXplLCBwSW5zdGFuY2UpIHtcclxuICAgIHRoaXMuX2ZvbnQgPSBmb250O1xyXG4gICAgdGhpcy5fdGV4dCA9IHRleHQ7XHJcbiAgICB0aGlzLl9mb250U2l6ZSA9IChmb250U2l6ZSAhPT0gdW5kZWZpbmVkKSA/IGZvbnRTaXplIDogMTI7XHJcbiAgICB0aGlzLnAgPSBwSW5zdGFuY2UgfHwgd2luZG93OyAvLyBJZiBpbnN0YW5jZSBpcyBvbWl0dGVkLCBhc3N1bWUgZ2xvYmFsIHNjb3BlXHJcbiAgICB0aGlzLl9yb3RhdGlvbiA9IDA7XHJcbiAgICB0aGlzLl9oQWxpZ24gPSBCYm94QWxpZ25lZFRleHQuQUxJR04uQ0VOVEVSO1xyXG4gICAgdGhpcy5fdkFsaWduID0gQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkNFTlRFUjtcclxuICAgIHRoaXMuX2NhbGN1bGF0ZU1ldHJpY3MoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFZlcnRpY2FsIGFsaWdubWVudCB2YWx1ZXNcclxuICogQHB1YmxpY1xyXG4gKiBAc3RhdGljXHJcbiAqIEByZWFkb25seVxyXG4gKiBAZW51bSB7c3RyaW5nfVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LkFMSUdOID0ge1xyXG4gICAgTEVGVDogXCJsZWZ0XCIsXHJcbiAgICBDRU5URVI6IFwiY2VudGVyXCIsXHJcbiAgICBSSUdIVDogXCJyaWdodFwiXHJcbn07XHJcblxyXG4vKipcclxuICogQmFzZWxpbmUgYWxpZ25tZW50IHZhbHVlc1xyXG4gKiBAcHVibGljXHJcbiAqIEBzdGF0aWNcclxuICogQHJlYWRvbmx5XHJcbiAqIEBlbnVtIHtzdHJpbmd9XHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQuQkFTRUxJTkUgPSB7XHJcbiAgICBUT1A6IFwidG9wXCIsXHJcbiAgICBDRU5URVI6IFwiY2VudGVyXCIsXHJcbiAgICBBTFBIQUJFVElDOiBcImFscGhhYmV0aWNcIixcclxuICAgIEJPVFRPTTogXCJib3R0b21cIlxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdXJyZW50IHRleHRcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIHRleHQgc3RyaW5nIHRvIGRpc3BsYXlcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuc2V0VGV4dCA9IGZ1bmN0aW9uKHN0cmluZykge1xyXG4gICAgdGhpcy5fdGV4dCA9IHN0cmluZztcclxuICAgIHRoaXMuX2NhbGN1bGF0ZU1ldHJpY3MoKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXQgY3VycmVudCB0ZXh0IHNpemVcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge251bWJlcn0gZm9udFNpemUgdGV4dCBzaXplXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLnNldFRleHRTaXplID0gZnVuY3Rpb24oZm9udFNpemUpIHtcclxuICAgIHRoaXMuX2ZvbnRTaXplID0gZm9udFNpemU7XHJcbiAgICB0aGlzLl9jYWxjdWxhdGVNZXRyaWNzKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogU2V0IHJvdGF0aW9uIG9mIHRleHRcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgcm90YXRpb24gaW4gcmFkaWFuc1xyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5zZXRSb3RhdGlvbiA9IGZ1bmN0aW9uKGFuZ2xlKSB7XHJcbiAgICB0aGlzLl9yb3RhdGlvbiA9IGFuZ2xlO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBhbmNob3IgcG9pbnQgZm9yIHRleHQgKGhvcml6b25hbCBhbmQgdmVydGljYWwgYWxpZ25tZW50KSByZWxhdGl2ZSB0b1xyXG4gKiBib3VuZGluZyBib3hcclxuICogQHB1YmxpY1xyXG4gKiBAcGFyYW0ge3N0cmluZ30gW2hBbGlnbj1DRU5URVJdIGhvcml6b25hbCBhbGlnbm1lbnRcclxuICogQHBhcmFtIHtzdHJpbmd9IFt2QWxpZ249Q0VOVEVSXSB2ZXJ0aWNhbCBiYXNlbGluZVxyXG4gKi9cclxuQmJveEFsaWduZWRUZXh0LnByb3RvdHlwZS5zZXRBbmNob3IgPSBmdW5jdGlvbihoQWxpZ24sIHZBbGlnbikge1xyXG4gICAgdGhpcy5faEFsaWduID0gaEFsaWduIHx8IEJib3hBbGlnbmVkVGV4dC5BTElHTi5DRU5URVI7XHJcbiAgICB0aGlzLl92QWxpZ24gPSB2QWxpZ24gfHwgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkNFTlRFUjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBEcmF3cyB0aGUgdGV4dCBwYXJ0aWNsZSB3aXRoIHRoZSBzcGVjaWZpZWQgc3R5bGUgcGFyYW1ldGVyc1xyXG4gKiBAcHVibGljXHJcbiAqIEBwYXJhbSAge251bWJlcn0gIHggICAgICAgICAgICAgICAgICB4IGNvb3JkaW5hdGUgb2YgdGV4dCBhbmNob3JcclxuICogQHBhcmFtICB7bnVtYmVyfSAgeSAgICAgICAgICAgICAgICAgIHkgY29vcmRpbmF0ZSBvZiB0ZXh0IGFuY2hvclxyXG4gKiBAcGFyYW0gIHtib29sZWFufSBbZHJhd0JvdW5kcz1mYWxzZV0gZmxhZyBmb3IgZHJhd2luZyBib3VuZGluZyBib3hcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uKHgsIHksIGRyYXdCb3VuZHMpIHtcclxuICAgIGRyYXdCb3VuZHMgPSBkcmF3Qm91bmRzIHx8IGZhbHNlO1xyXG4gICAgdmFyIHBvcyA9IHtcclxuICAgICAgICB4OiAoeCAhPT0gdW5kZWZpbmVkKSA/IHggOiAwLCBcclxuICAgICAgICB5OiAoeSAhPT0gdW5kZWZpbmVkKSA/IHkgOiAwXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucC5wdXNoKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9yb3RhdGlvbikge1xyXG4gICAgICAgICAgICBwb3MgPSB0aGlzLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzKHBvcy54LCBwb3MueSwgdGhpcy5fcm90YXRpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnAucm90YXRlKHRoaXMuX3JvdGF0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHBvcyA9IHRoaXMuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMocG9zLngsIHBvcy55KTtcclxuXHJcbiAgICAgICAgdGhpcy5wLnRleHRBbGlnbih0aGlzLnAuTEVGVCwgdGhpcy5wLkJBU0VMSU5FKTtcclxuICAgICAgICB0aGlzLnAudGV4dEZvbnQodGhpcy5fZm9udCk7XHJcbiAgICAgICAgdGhpcy5wLnRleHRTaXplKHRoaXMuX2ZvbnRTaXplKTtcclxuICAgICAgICB0aGlzLnAudGV4dCh0aGlzLl90ZXh0LCBwb3MueCwgcG9zLnkpO1xyXG5cclxuICAgICAgICBpZiAoZHJhd0JvdW5kcykge1xyXG4gICAgICAgICAgICB0aGlzLnAuc3Ryb2tlKDIwMCk7XHJcbiAgICAgICAgICAgIHZhciBib3VuZHNYID0gcG9zLnggKyB0aGlzLl9ib3VuZHNPZmZzZXQueDtcclxuICAgICAgICAgICAgdmFyIGJvdW5kc1kgPSBwb3MueSArIHRoaXMuX2JvdW5kc09mZnNldC55O1xyXG4gICAgICAgICAgICB0aGlzLnAubm9GaWxsKCk7XHJcbiAgICAgICAgICAgIHRoaXMucC5yZWN0KGJvdW5kc1gsIGJvdW5kc1ksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsgICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgdGhpcy5wLnBvcCgpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFByb2plY3QgdGhlIGNvb3JkaW5hdGVzICh4LCB5KSBpbnRvIGEgcm90YXRlZCBjb29yZGluYXRlIHN5c3RlbVxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgIHggY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHkgICAgIHkgY29vcmRpbmF0ZSAoaW4gdW5yb3RhdGVkIHNwYWNlKVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IGFuZ2xlIHJhZGlhbnMgb2Ygcm90YXRpb24gdG8gYXBwbHlcclxuICogQHJldHVybiB7b2JqZWN0fSAgICAgICBvYmplY3Qgd2l0aCB4ICYgeSBwcm9wZXJ0aWVzXHJcbiAqL1xyXG5CYm94QWxpZ25lZFRleHQucHJvdG90eXBlLl9jYWxjdWxhdGVSb3RhdGVkQ29vcmRzID0gZnVuY3Rpb24gKHgsIHksIGFuZ2xlKSB7ICBcclxuICAgIHZhciByeCA9IE1hdGguY29zKGFuZ2xlKSAqIHggKyBNYXRoLmNvcyhNYXRoLlBJIC8gMiAtIGFuZ2xlKSAqIHk7XHJcbiAgICB2YXIgcnkgPSAtTWF0aC5zaW4oYW5nbGUpICogeCArIE1hdGguc2luKE1hdGguUEkgLyAyIC0gYW5nbGUpICogeTtcclxuICAgIHJldHVybiB7eDogcngsIHk6IHJ5fTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDYWxjdWxhdGVzIGRyYXcgY29vcmRpbmF0ZXMgZm9yIHRoZSB0ZXh0LCBhbGlnbmluZyBiYXNlZCBvbiB0aGUgYm91bmRpbmcgYm94LlxyXG4gKiBUaGUgdGV4dCBpcyBldmVudHVhbGx5IGRyYXduIHdpdGggY2FudmFzIGFsaWdubWVudCBzZXQgdG8gbGVmdCAmIGJhc2VsaW5lLCBzb1xyXG4gKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGEgZGVzaXJlZCBwb3MgJiBhbGlnbm1lbnQgYW5kIHJldHVybnMgdGhlIGFwcHJvcHJpYXRlXHJcbiAqIGNvb3JkaW5hdGVzIGZvciB0aGUgbGVmdCAmIGJhc2VsaW5lLlxyXG4gKiBAcHJpdmF0ZVxyXG4gKiBAcGFyYW0gIHtudW1iZXJ9IHggICAgICB4IGNvb3JkaW5hdGVcclxuICogQHBhcmFtICB7bnVtYmVyfSB5ICAgICAgeSBjb29yZGluYXRlXHJcbiAqIEByZXR1cm4ge29iamVjdH0gICAgICAgIG9iamVjdCB3aXRoIHggJiB5IHByb3BlcnRpZXNcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuX2NhbGN1bGF0ZUFsaWduZWRDb29yZHMgPSBmdW5jdGlvbih4LCB5KSB7XHJcbiAgICB2YXIgbmV3WCwgbmV3WTtcclxuICAgIHN3aXRjaCAodGhpcy5faEFsaWduKSB7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uTEVGVDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkFMSUdOLkNFTlRFUjpcclxuICAgICAgICAgICAgbmV3WCA9IHggLSB0aGlzLmhhbGZXaWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQUxJR04uUklHSFQ6XHJcbiAgICAgICAgICAgIG5ld1ggPSB4IC0gdGhpcy53aWR0aDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3WCA9IHg7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pemVkIGhvcml6b25hbCBhbGlnbjpcIiwgdGhpcy5faEFsaWduKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKHRoaXMuX3ZBbGlnbikge1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLlRPUDpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9ib3VuZHNPZmZzZXQueTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBCYm94QWxpZ25lZFRleHQuQkFTRUxJTkUuQ0VOVEVSOlxyXG4gICAgICAgICAgICBuZXdZID0geSArIHRoaXMuX2Rpc3RCYXNlVG9NaWQ7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgQmJveEFsaWduZWRUZXh0LkJBU0VMSU5FLkJPVFRPTTpcclxuICAgICAgICAgICAgbmV3WSA9IHkgLSB0aGlzLl9kaXN0QmFzZVRvQm90dG9tO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEJib3hBbGlnbmVkVGV4dC5CQVNFTElORS5BTFBIQUJFVElDOlxyXG4gICAgICAgICAgICBuZXdZID0geTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgbmV3WSA9IHk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5yZWNvZ25pemVkIHZlcnRpY2FsIGFsaWduOlwiLCB0aGlzLl92QWxpZ24pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiB7eDogbmV3WCwgeTogbmV3WX07XHJcbn07XHJcblxyXG5cclxuLyoqXHJcbiAqIENhbGN1bGF0ZXMgYm91bmRpbmcgYm94IGFuZCB2YXJpb3VzIG1ldHJpY3MgZm9yIHRoZSBjdXJyZW50IHRleHQgYW5kIGZvbnRcclxuICogQHByaXZhdGVcclxuICovXHJcbkJib3hBbGlnbmVkVGV4dC5wcm90b3R5cGUuX2NhbGN1bGF0ZU1ldHJpY3MgPSBmdW5jdGlvbigpIHsgIFxyXG4gICAgLy8gcDUgMC41LjAgaGFzIGEgYnVnIC0gdGV4dCBib3VuZHMgYXJlIGNsaXBwZWQgYnkgKDAsIDApXHJcbiAgICAvLyBDYWxjdWxhdGluZyBib3VuZHMgaGFja1xyXG4gICAgdmFyIGJvdW5kcyA9IHRoaXMuX2ZvbnQudGV4dEJvdW5kcyh0aGlzLl90ZXh0LCAxMDAwLCAxMDAwLCB0aGlzLl9mb250U2l6ZSk7XHJcbiAgICBib3VuZHMueCAtPSAxMDAwO1xyXG4gICAgYm91bmRzLnkgLT0gMTAwMDtcclxuXHJcbiAgICAvLyBVc2UgYm91bmRzIHRvIGNhbGN1bGF0ZSBmb250IG1ldHJpY3NcclxuICAgIHRoaXMud2lkdGggPSBib3VuZHMudztcclxuICAgIHRoaXMuaGVpZ2h0ID0gYm91bmRzLmg7XHJcbiAgICB0aGlzLmhhbGZXaWR0aCA9IHRoaXMud2lkdGggLyAyO1xyXG4gICAgdGhpcy5oYWxmSGVpZ2h0ID0gdGhpcy5oZWlnaHQgLyAyO1xyXG4gICAgdGhpcy5fYm91bmRzT2Zmc2V0ID0ge3g6IGJvdW5kcy54LCB5OiBib3VuZHMueX07XHJcbiAgICB0aGlzLl9kaXN0QmFzZVRvTWlkID0gTWF0aC5hYnMoYm91bmRzLnkpIC0gdGhpcy5oYWxmSGVpZ2h0O1xyXG4gICAgdGhpcy5fZGlzdEJhc2VUb0JvdHRvbSA9IHRoaXMuaGVpZ2h0IC0gTWF0aC5hYnMoYm91bmRzLnkpO1xyXG59O1xufSx7fV19LHt9LFsxXSkoMSlcbn0pO1xuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
